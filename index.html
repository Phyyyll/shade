<!DOCTYPE html>
<html>
  <head>
    <title>Testing</title>
    <style>
      /* Add your CSS styles here */
      .highlighted {
        background-color: yellow;
      }
      .highlighted-like {
        background-color: green;
      }
      .highlighted-dislike {
        background-color: red;
      }
    </style>
  </head>
  <body>
    <form style="display: flex; flex-direction: column; gap: 24">
      <div style="display: flex; gap: 16px; align-items: center">
        <label>
          <input
            type="radio"
            name="action"
            value="green"
            onclick="setHighlightColor(this.value);"
          />
          Like
        </label>
        <label>
          <input
            type="radio"
            name="action"
            value="red"
            onclick="setHighlightColor(this.value);"
          />
          Dislike
        </label>
        <label>
          <input
            type="radio"
            name="action"
            value="yellow"
            onclick="setHighlightColor(this.value);"
          />
          Do not understand
        </label>
        <label>
          <input
            type="radio"
            name="action"
            value="transparent"
            onclick="setHighlightColor(this.value);"
          />
          Erase
        </label>
      </div>
      <div id="container" onmouseup="handleHighlight()">
        <p>
          Technology has transformed the way we live, work, and communicate.
          From the invention of the wheel to the creation of the internet, each
          new innovation has revolutionized society and opened up new
          possibilities. We now have the power to connect with people on the
          other side of the world in an instant, access a wealth of information
          at our fingertips, and even explore virtual realms through immersive
          virtual reality experiences.
        </p>
      </div>
    </form>
    <script>
      // Add your JavaScript code here
      let highlightColor = "green";
      let selectedButton = "Like"; // Default value

      function setHighlightColor(color) {
        highlightColor = color;
        selectedButton = document
          .querySelector('input[name="action"]:checked')
          .nextSibling.textContent.trim();
      }

      function handleHighlight() {
        const highlighted = window.getSelection();
        if (!highlighted.toString().replace(/\s/g, "")) return;
        const range = highlighted.getRangeAt(0);
        document.designMode = "on";
        if (range) {
          highlighted.removeAllRanges();
          highlighted.addRange(range);
        }
        if (highlightColor !== "transparent") {
          document.execCommand("backColor", false, highlightColor);
        } else {
          document.execCommand("removeFormat");
        }
        document.designMode = "off";
        logHighlightIndices(selectedButton);
        window.getSelection().removeAllRanges();
      }

      function logHighlightIndices(button) {
        const container = document.getElementById("container");
        if (!container) return;

        const paragraph = container.querySelector("p");
        if (!paragraph) return;

        const highlightedText = window.getSelection().toString();
        const paragraphText = paragraph.textContent.trim();
        const startIdx = paragraphText.indexOf(highlightedText) + 1;
        const endIdx = startIdx + highlightedText.length - 1;

        console.log(
          `Highlight starts at index: ${startIdx}, and ends at index: ${endIdx}`
        );
        console.log(`Selected button: ${button}`);
      }
    </script>
  </body>
</html>
